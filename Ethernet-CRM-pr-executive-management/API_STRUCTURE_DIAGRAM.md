# ğŸ—ºï¸ Ethernet CRM - API Structure Diagram

Visual representation of the complete API architecture.

## ğŸ—ï¸ System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     CLIENT APPLICATIONS                     â”‚
â”‚                                                             â”‚
â”‚  â€¢ Web Frontend (React)                                    â”‚
â”‚  â€¢ Mobile App                                              â”‚
â”‚  â€¢ Postman / CURL                                          â”‚
â”‚  â€¢ Third-party Integrations                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â”‚ HTTP/HTTPS
                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    API GATEWAY                              â”‚
â”‚           http://localhost:3000/api/v1                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                â”‚                â”‚
         â–¼                â–¼                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Public    â”‚  â”‚  Protected  â”‚  â”‚   Admin     â”‚
â”‚  Endpoints  â”‚  â”‚  Endpoints  â”‚  â”‚  Endpoints  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š API Module Breakdown

```
                    Ethernet CRM API
                           â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                   â”‚                   â”‚
       â–¼                   â–¼                   â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Health â”‚        â”‚   Auth   â”‚       â”‚   User   â”‚
  â”‚  Check  â”‚        â”‚          â”‚       â”‚   Mgmt   â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                   â”‚                   â”‚
       â”‚                   â”‚                   â”‚
       â–¼                   â–¼                   â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Expense â”‚        â”‚  Survey  â”‚       â”‚   RBAC   â”‚
  â”‚  Mgmt   â”‚        â”‚   Mgmt   â”‚       â”‚  System  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” Authentication Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Client     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1. POST /auth/register or /auth/login
       â”‚    { identifier, password }
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Auth Controller    â”‚
â”‚                      â”‚
â”‚  â€¢ Validate user     â”‚
â”‚  â€¢ Check password    â”‚
â”‚  â€¢ Generate tokens   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 2. Response with tokens
       â”‚    { accessToken, refreshToken }
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Client     â”‚
â”‚              â”‚
â”‚  Store tokensâ”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 3. API Request with token
       â”‚    Authorization: Bearer <accessToken>
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Auth Middleware     â”‚
â”‚                      â”‚
â”‚  â€¢ Verify token      â”‚
â”‚  â€¢ Check expiry      â”‚
â”‚  â€¢ Validate user     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€ Valid â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                             â”‚
       â”‚                             â–¼
       â”‚                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                     â”‚  Protected   â”‚
       â”‚                     â”‚  Resource    â”‚
       â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â””â”€â”€â”€ Expired â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                     â”‚
                                     â–¼
                             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                             â”‚   401 Error  â”‚
                             â”‚              â”‚
                             â”‚ Use /refresh â”‚
                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸŒ³ Complete Endpoint Tree

```
/api/v1
â”‚
â”œâ”€â”€ /health â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ GET  âœ… Server health check
â”‚
â”œâ”€â”€ /auth
â”‚   â”œâ”€â”€ /register â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ POST âœ… Create account
â”‚   â”œâ”€â”€ /login â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ POST âœ… User login
â”‚   â”œâ”€â”€ /profile â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ GET  ğŸ”’ Get user profile
â”‚   â”œâ”€â”€ /refresh â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ POST âœ… Refresh tokens
â”‚   â””â”€â”€ /logout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ POST ğŸ”’ Logout user
â”‚
â”œâ”€â”€ /users
â”‚   â”œâ”€â”€ / â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ GET  ğŸ‘‘ List all users
â”‚   â”œâ”€â”€ /:id â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ GET  ğŸ”’ Get user by ID
â”‚   â”œâ”€â”€ /:id â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ PUT  ğŸ”’ Update user
â”‚   â””â”€â”€ /:id â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ DEL  ğŸ‘‘ Delete user
â”‚
â”œâ”€â”€ /leads
â”‚   â”œâ”€â”€ /health â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ GET  âœ… Module health
â”‚   â”‚
â”‚   â”œâ”€â”€ /expense
â”‚   â”‚   â”œâ”€â”€ /add â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ POST ğŸ“ Submit expense
â”‚   â”‚   â”œâ”€â”€ / â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ GET  ğŸ“Š List expenses
â”‚   â”‚   â””â”€â”€ /approve/:id â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ POST ğŸ‘‘ Approve/reject
â”‚   â”‚
â”‚   â”œâ”€â”€ /survey
â”‚   â”‚   â”œâ”€â”€ / â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ GET  âœ… List surveys
â”‚   â”‚   â”œâ”€â”€ /add â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ POST âœ… Submit survey
â”‚   â”‚   â””â”€â”€ /summary â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ GET  âœ… Get statistics
â”‚   â”‚
â”‚   â””â”€â”€ /em
â”‚       â””â”€â”€ /users
â”‚           â”œâ”€â”€ / â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ POST ğŸ‘‘ Create EM user
â”‚           â”œâ”€â”€ / â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ GET  ğŸ‘‘ List EM users
â”‚           â””â”€â”€ /:id â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ GET  ğŸ‘‘ Get EM user
â”‚
â”œâ”€â”€ /role
â”‚   â”œâ”€â”€ / â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ POST ğŸ‘‘ Create role
â”‚   â””â”€â”€ / â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ GET  ğŸ”’ List roles
â”‚
â””â”€â”€ /module
    â”œâ”€â”€ / â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ POST ğŸ‘‘ Create module
    â””â”€â”€ / â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ GET  ğŸ”’ List modules

Legend:
  âœ… Public (No auth required)
  ğŸ”’ Protected (Auth required)
  ğŸ‘‘ Admin (Auth + Admin role)
  ğŸ“ File upload supported
  ğŸ“Š Pagination supported
```

---

## ğŸ”„ Data Flow Diagrams

### User Registration Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    1. POST /auth/register         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚   Server   â”‚
â”‚         â”‚    { name, password, etc }         â”‚            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
     â–²                                               â”‚
     â”‚                                               â”‚ 2. Validate
     â”‚                                               â”‚    Data
     â”‚                                               â–¼
     â”‚                                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                                         â”‚ Database â”‚
     â”‚                                         â”‚          â”‚
     â”‚                                         â”‚ â€¢ Check  â”‚
     â”‚                                         â”‚   exists â”‚
     â”‚                                         â”‚ â€¢ Hash   â”‚
     â”‚                                         â”‚   pwd    â”‚
     â”‚                                         â”‚ â€¢ Insert â”‚
     â”‚                                         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚                                              â”‚
     â”‚                                              â”‚ 3. User
     â”‚                                              â”‚    Created
     â”‚                                              â–¼
     â”‚                                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                                         â”‚  JWT     â”‚
     â”‚                                         â”‚  Service â”‚
     â”‚                                         â”‚          â”‚
     â”‚                                         â”‚ Generate â”‚
     â”‚                                         â”‚ Tokens   â”‚
     â”‚                                         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚                                              â”‚
     â”‚    4. Response with tokens                   â”‚
     â”‚    { user, accessToken, refreshToken }      â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Expense Submission Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   1. POST /leads/expense/add    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Employee â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  Server  â”‚
â”‚         â”‚   â€¢ category                     â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â€¢ amount                       â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
              â€¢ distance                          â”‚
              â€¢ billImages                        â”‚ 2. Validate
                                                  â”‚    Business
                                                  â”‚    Rules
                                                  â–¼
                                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                            â”‚ Business â”‚
                                            â”‚  Logic   â”‚
                                            â”‚          â”‚
                                            â”‚ Food?    â”‚
                                            â”‚ â€¢ < 30km?â”‚
                                            â”‚ â€¢ > 120? â”‚
                                            â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚                         â”‚              â”‚
                   PASSâ”‚                     FAILâ”‚              â”‚
                       â–¼                         â–¼              â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
              â”‚   Process    â”‚         â”‚    Reject    â”‚        â”‚
              â”‚   Images     â”‚         â”‚   with msg   â”‚        â”‚
              â”‚              â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
              â”‚ â€¢ Convert    â”‚                                 â”‚
              â”‚   to base64  â”‚                                 â”‚
              â”‚ â€¢ Store      â”‚                                 â”‚
              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚
                     â”‚                                         â”‚
                     â”‚ 3. Save to DB                           â”‚
                     â–¼                                         â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
              â”‚   Database   â”‚                                 â”‚
              â”‚              â”‚                                 â”‚
              â”‚  Insert      â”‚                                 â”‚
              â”‚  Expense     â”‚                                 â”‚
              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚
                     â”‚                                         â”‚
                     â”‚ 4. Return created expense               â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Token Refresh Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client  â”‚
â”‚         â”‚
â”‚ Makes   â”‚
â”‚ Request â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚
     â”‚ GET /auth/profile
     â”‚ Authorization: Bearer <expired_token>
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Server    â”‚
â”‚              â”‚
â”‚ Verify Token â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Token Expired!
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Return 401   â”‚
â”‚ Unauthorized â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Client     â”‚
â”‚              â”‚
â”‚ Detect 401   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ POST /auth/refresh
       â”‚ { refreshToken }
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Server    â”‚
â”‚              â”‚
â”‚ â€¢ Verify     â”‚
â”‚   refresh    â”‚
â”‚   token      â”‚
â”‚ â€¢ Check DB   â”‚
â”‚ â€¢ Generate   â”‚
â”‚   new tokens â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ { accessToken, refreshToken }
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Client     â”‚
â”‚              â”‚
â”‚ â€¢ Store new  â”‚
â”‚   tokens     â”‚
â”‚ â€¢ Retry      â”‚
â”‚   original   â”‚
â”‚   request    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ­ Role-Based Access Control (RBAC) Structure

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚     USER     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ has one
                           â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚     ROLE     â”‚
                    â”‚              â”‚
                    â”‚ â€¢ Admin      â”‚
                    â”‚ â€¢ Manager    â”‚
                    â”‚ â€¢ Employee   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ has many
                           â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   MODULES    â”‚
                    â”‚              â”‚
                    â”‚ â€¢ Users      â”‚
                    â”‚ â€¢ Expenses   â”‚
                    â”‚ â€¢ Surveys    â”‚
                    â”‚ â€¢ Reports    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Example:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User: John Doe                                         â”‚
â”‚  Role: Manager                                          â”‚
â”‚  Modules: [Expense Management, Survey Management]       â”‚
â”‚                                                         â”‚
â”‚  Permissions:                                           â”‚
â”‚  âœ… Can view expenses                                   â”‚
â”‚  âœ… Can approve/reject expenses                         â”‚
â”‚  âœ… Can view surveys                                    â”‚
â”‚  âŒ Cannot manage users (not assigned)                  â”‚
â”‚  âŒ Cannot delete data (not admin)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’¾ Database Relationships

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     USER      â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ id (PK)       â”‚
â”‚ name          â”‚
â”‚ employeCode   â”‚
â”‚ phoneNumber   â”‚
â”‚ email         â”‚
â”‚ password      â”‚
â”‚ role_id (FK)  â”‚â”€â”€â”€â”€â”€â”€â”
â”‚ refreshToken  â”‚      â”‚
â”‚ isActive      â”‚      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
       â”‚               â”‚
       â”‚               â”‚
       â”‚ has many      â”‚ belongs to
       â”‚               â”‚
       â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   EXPENSE     â”‚  â”‚     ROLE     â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ id (PK)       â”‚  â”‚ id (PK)      â”‚
â”‚ category      â”‚  â”‚ name         â”‚
â”‚ amount        â”‚  â”‚ description  â”‚
â”‚ distance      â”‚  â”‚ is_active    â”‚
â”‚ billImages    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ status        â”‚         â”‚
â”‚ user (JSON)   â”‚         â”‚ many-to-many
â”‚ date          â”‚         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   MODULES    â”‚
â”‚    SURVEY     â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚ id (PK)      â”‚
â”‚ id (PK)       â”‚  â”‚ name         â”‚
â”‚ serviceRating â”‚  â”‚ description  â”‚
â”‚ heardFrom     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ likedFeatures â”‚         â”‚
â”‚ suggestions   â”‚         â”‚
â”‚ customerName  â”‚         â”‚
â”‚ customerEmail â”‚         â–¼
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚ ROLE_MODULE_MAP  â”‚
                   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
                   â”‚ role_id (FK)     â”‚
                   â”‚ module_id (FK)   â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”’ Security Layers

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Layer 7: Application                 â”‚
â”‚                                                         â”‚
â”‚  â€¢ Input Validation                                     â”‚
â”‚  â€¢ Business Logic Authorization                         â”‚
â”‚  â€¢ Data Sanitization                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Layer 6: Middleware                     â”‚
â”‚                                                         â”‚
â”‚  â€¢ JWT Verification                                     â”‚
â”‚  â€¢ Role Checking                                        â”‚
â”‚  â€¢ Request Validation                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Layer 5: Authentication                    â”‚
â”‚                                                         â”‚
â”‚  â€¢ Password Hashing (bcrypt)                            â”‚
â”‚  â€¢ Token Generation                                     â”‚
â”‚  â€¢ Session Management                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                Layer 4: Network                         â”‚
â”‚                                                         â”‚
â”‚  â€¢ CORS                                                 â”‚
â”‚  â€¢ Helmet.js                                            â”‚
â”‚  â€¢ Rate Limiting (to be implemented)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                Layer 3: Database                        â”‚
â”‚                                                         â”‚
â”‚  â€¢ SQL Injection Prevention (Sequelize ORM)             â”‚
â”‚  â€¢ Prepared Statements                                  â”‚
â”‚  â€¢ Connection Pooling                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ Request/Response Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Client  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ HTTP Request
     â”‚ â€¢ Method (GET/POST/PUT/DELETE)
     â”‚ â€¢ Headers (Content-Type, Authorization)
     â”‚ â€¢ Body (JSON/FormData)
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Express Server    â”‚
â”‚                     â”‚
â”‚  1. Parse Request   â”‚
â”‚     â€¢ Body Parser   â”‚
â”‚     â€¢ URL Parser    â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Middleware       â”‚
â”‚                     â”‚
â”‚  2. Authenticate    â”‚
â”‚     â€¢ Check token   â”‚
â”‚     â€¢ Verify user   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Validation        â”‚
â”‚                     â”‚
â”‚  3. Validate Input  â”‚
â”‚     â€¢ Required      â”‚
â”‚     â€¢ Format        â”‚
â”‚     â€¢ Business      â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Controller        â”‚
â”‚                     â”‚
â”‚  4. Process Logic   â”‚
â”‚     â€¢ Business      â”‚
â”‚     â€¢ Database      â”‚
â”‚     â€¢ Transform     â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Database         â”‚
â”‚                     â”‚
â”‚  5. Execute Query   â”‚
â”‚     â€¢ CRUD          â”‚
â”‚     â€¢ Transactions  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ Results
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Response          â”‚
â”‚                     â”‚
â”‚  6. Format & Send   â”‚
â”‚     â€¢ JSON          â”‚
â”‚     â€¢ Status Code   â”‚
â”‚     â€¢ Headers       â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ HTTP Response
     â”‚ â€¢ Status Code
     â”‚ â€¢ Headers
     â”‚ â€¢ Body (JSON)
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Client  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ API Design Patterns

### RESTful Resource Naming

```
Resource              Collection           Single Item
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Users                 GET    /users        GET    /users/:id
                      POST   /users        PUT    /users/:id
                                           DELETE /users/:id

Expenses              GET    /expense      GET    /expense/:id
                      POST   /expense/add  POST   /expense/approve/:id

Surveys               GET    /survey       
                      POST   /survey/add   
                      GET    /survey/summary

Roles                 GET    /role         
                      POST   /role         

Modules               GET    /module       
                      POST   /module       
```

### HTTP Methods Usage

```
GET     â†’ Retrieve data (list or single)
POST    â†’ Create new resource
PUT     â†’ Update existing resource
DELETE  â†’ Remove resource

Examples:
GET    /users          â†’ List all users
GET    /users/1        â†’ Get user with ID 1
POST   /users          â†’ Create new user
PUT    /users/1        â†’ Update user with ID 1
DELETE /users/1        â†’ Delete user with ID 1
```

---

## ğŸš€ Performance Considerations

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Optimization Layers                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. CLIENT SIDE
   â”œâ”€â”€ Token caching
   â”œâ”€â”€ Response caching
   â”œâ”€â”€ Request batching
   â””â”€â”€ Lazy loading

2. NETWORK LAYER
   â”œâ”€â”€ Compression (gzip)
   â”œâ”€â”€ CDN (static files)
   â”œâ”€â”€ HTTP/2
   â””â”€â”€ Connection pooling

3. APPLICATION LAYER
   â”œâ”€â”€ Pagination (10 items/page)
   â”œâ”€â”€ Field selection
   â”œâ”€â”€ Query optimization
   â””â”€â”€ Async processing

4. DATABASE LAYER
   â”œâ”€â”€ Indexing (id, employeCode, etc.)
   â”œâ”€â”€ Connection pooling
   â”œâ”€â”€ Query optimization
   â””â”€â”€ Caching (Redis - future)

5. FILE HANDLING
   â”œâ”€â”€ Base64 conversion (expenses)
   â”œâ”€â”€ File size limits (2 images max)
   â”œâ”€â”€ Async file operations
   â””â”€â”€ Cleanup after processing
```

---

## ğŸ“ˆ Scalability Roadmap

```
Current State (v1.0)
â”œâ”€â”€ Monolithic architecture
â”œâ”€â”€ Single database
â”œâ”€â”€ In-memory token storage
â””â”€â”€ File storage in database

Future Enhancements
â”‚
â”œâ”€â”€ Phase 1: Optimization
â”‚   â”œâ”€â”€ Implement Redis for tokens
â”‚   â”œâ”€â”€ Add database indexing
â”‚   â”œâ”€â”€ Implement caching
â”‚   â””â”€â”€ Add rate limiting
â”‚
â”œâ”€â”€ Phase 2: Microservices
â”‚   â”œâ”€â”€ Auth service
â”‚   â”œâ”€â”€ User service
â”‚   â”œâ”€â”€ Expense service
â”‚   â””â”€â”€ Survey service
â”‚
â”œâ”€â”€ Phase 3: Cloud & Scale
â”‚   â”œâ”€â”€ Cloud storage for files
â”‚   â”œâ”€â”€ Load balancing
â”‚   â”œâ”€â”€ Database replication
â”‚   â””â”€â”€ Horizontal scaling
â”‚
â””â”€â”€ Phase 4: Advanced Features
    â”œâ”€â”€ Real-time notifications
    â”œâ”€â”€ Advanced analytics
    â”œâ”€â”€ Mobile app APIs
    â””â”€â”€ Third-party integrations
```

---

*This diagram provides a visual overview of the API structure. For detailed endpoint information, refer to other documentation files.*

*Last Updated: November 7, 2024*

